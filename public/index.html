<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OrangeX • USDT Trade (MVP)</title>
  <style>
    :root{
      --bg:#0b0f17; --card:#121a2a; --card2:#0f1726; --text:#e8eefc; --muted:#94a3b8;
      --line:rgba(148,163,184,.18); --accent:#ff7a00; --good:#22c55e; --bad:#ef4444; --warn:#fbbf24;
      --shadow: 0 12px 30px rgba(0,0,0,.45);
      --r:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 700px at 20% 0%, rgba(255,122,0,.12), transparent 60%),
                         radial-gradient(900px 600px at 90% 20%, rgba(59,130,246,.10), transparent 55%),
                         var(--bg);
         color:var(--text); font: 14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;}
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:22px 18px 70px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:34px;height:34px;border-radius:10px;background:conic-gradient(from 180deg, #ff7a00, #ffb100, #ff7a00);
          box-shadow:0 0 0 4px rgba(255,122,0,.14)}
    .brand h1{font-size:16px;margin:0}
    .brand small{color:var(--muted)}
    .top-actions{display:flex;gap:10px;align-items:center}
    .pill{border:1px solid var(--line);background:rgba(18,26,42,.7);padding:8px 10px;border-radius:999px;color:var(--muted)}
    .btn{cursor:pointer;border:1px solid var(--line);background:rgba(18,26,42,.9);color:var(--text);
         padding:10px 12px;border-radius:12px;transition:.15s;display:inline-flex;gap:8px;align-items:center}
    .btn:hover{transform:translateY(-1px);border-color:rgba(255,122,0,.5)}
    .btn.primary{background:linear-gradient(180deg, rgba(255,122,0,.95), rgba(255,122,0,.75));border:0;color:#1a120a}
    .btn.ghost{background:transparent}
    .grid{display:grid;grid-template-columns: 1.2fr .8fr; gap:14px; margin-top:14px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg, rgba(18,26,42,.88), rgba(14,20,34,.88));
          border:1px solid var(--line); border-radius:var(--r); box-shadow: var(--shadow)}
    .card .hd{padding:14px 14px 10px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
    .card .hd h2{font-size:14px;margin:0}
    .card .hd p{margin:4px 0 0;color:var(--muted);font-size:12px}
    .card .bd{padding:14px}
    .tabs{display:flex;gap:8px}
    .tab{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(15,23,38,.7);color:var(--muted);cursor:pointer}
    .tab.active{background:rgba(255,122,0,.14);border-color:rgba(255,122,0,.55);color:var(--text)}
    .row{display:grid;grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 520px){.row{grid-template-columns:1fr}}
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    input, select, textarea{
      width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--line);
      background:rgba(8,12,20,.7); color:var(--text); outline:none;
    }
    input:focus, select:focus, textarea:focus{border-color:rgba(255,122,0,.6); box-shadow:0 0 0 4px rgba(255,122,0,.14)}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .kpi{display:grid;grid-template-columns:1fr 1fr; gap:10px; margin-top:10px}
    .k{padding:12px;border:1px solid var(--line);border-radius:14px;background:rgba(15,23,38,.55)}
    .k .t{font-size:12px;color:var(--muted)}
    .k .v{font-size:16px;font-weight:650;margin-top:4px}
    .muted{color:var(--muted)}
    .split{display:flex;gap:10px;flex-wrap:wrap}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted);background:rgba(15,23,38,.55)}
    .badge.good{border-color:rgba(34,197,94,.45);color:#86efac;background:rgba(34,197,94,.08)}
    .badge.warn{border-color:rgba(251,191,36,.55);color:#fde68a;background:rgba(251,191,36,.08)}
    .badge.bad{border-color:rgba(239,68,68,.55);color:#fecaca;background:rgba(239,68,68,.08)}
    .hr{height:1px;background:var(--line);margin:14px 0}
    .list{display:flex;flex-direction:column;gap:10px}
    .item{padding:12px;border:1px solid var(--line);border-radius:14px;background:rgba(15,23,38,.55)}
    .item .top{display:flex;justify-content:space-between;gap:10px}
    .item .id{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px;color:var(--muted)}
    .item .st{font-size:12px}
    .right{display:flex;gap:10px;align-items:center;justify-content:flex-end}
    .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:rgba(18,26,42,.92);
          border:1px solid var(--line);border-radius:14px;padding:12px 14px;box-shadow:var(--shadow);display:none;max-width:min(560px, calc(100% - 24px))}
    .toast strong{display:block;margin-bottom:2px}
    .footnote{margin-top:12px;font-size:12px;color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>OrangeX <span class="muted">• orangex.center</span></h1>
          <small>USDT(테더) 구매/판매</small>
        </div>
      </div>
      <div class="top-actions">
        <div class="pill" id="serverPill">API: <span class="mono" id="apiBaseLabel">/api</span></div>
        <button class="btn ghost" id="btnLogin">로그인</button>
        <button class="btn primary" id="btnKyc">KYC 시작</button>
      </div>
    </header>

    <div class="grid">
      <!-- Left: Trade -->
      <section class="card">
        <div class="hd">
          <div>
            <h2>거래 만들기</h2>
            <p>견적(Quote)을 받은 뒤 주문(Order)을 생성합니다. (견적은 30초 유효)</p>
          </div>
          <div class="tabs" role="tablist" aria-label="trade side">

            <!-- USDT 매수 => https://payment.orangex.center/ko/buyer/buyorder -->
            <a class="tab" href="https://payment.orangex.center/ko/buyer/buyorder"
                    target="_blank" rel="noopener" role="tab" aria-selected="false">USDT 매수</a>

            <!-- USDT 매도 => https://payment.orangex.center/ko/seller/buyorder -->
            <a class="tab" href="https://payment.orangex.center/ko/seller/buyorder"
                    target="_blank" rel="noopener" role="tab" aria-selected="false">USDT 매도</a>

          </div>
        </div>

        <div class="bd">
          <div class="row">
            <div>
              <label>원화 금액 (KRW)</label>
              <input id="krw" inputmode="numeric" placeholder="예) 1,000,000" />
              <div class="hint">수수료/스프레드는 견적에서 반영됩니다.</div>
            </div>
            <div>
              <label>체인/네트워크</label>
              <select id="chain">
                <option value="TRC20" selected>TRON (TRC20) - 수수료 낮음</option>
                <option value="ERC20">Ethereum (ERC20) - 수수료 높음</option>
              </select>
              <div class="hint">MVP는 TRC20 권장</div>
            </div>
          </div>

          <div class="hr"></div>

          <div class="row">
            <div id="addrBox">
              <label id="addrLabel">USDT 수령 주소 (사용자 지갑)</label>
              <input id="address" class="mono" placeholder="예) TQ7... (TRC20 주소)" />
              <div class="hint" id="addrHint">매수 시: 결제 완료 후 이 주소로 USDT가 출금됩니다.</div>
            </div>
            <div id="bankBox" style="display:none">
              <label>원화 지급 계좌 (매도 시)</label>
              <input id="bankName" placeholder="은행명 (예: 국민/신한/하나)" />
              <div style="height:10px"></div>
              <input id="bankAcct" class="mono" placeholder="계좌번호" />
              <div class="hint">매도 시: USDT 입금 확인 후 이 계좌로 원화 지급</div>
            </div>
          </div>

          <div class="kpi">
            <div class="k">
              <div class="t">예상 환율(USDT/KRW)</div>
              <div class="v" id="kPrice">—</div>
              <div class="hint">실제 값은 서버 견적 기준</div>
            </div>
            <div class="k">
              <div class="t">예상 수령 USDT</div>
              <div class="v" id="kUsdt">—</div>
              <div class="hint" id="kUsdtHint">매수 기준: 수수료 제외 후 계산</div>
            </div>
          </div>

          <div class="hr"></div>

          <div class="split">
            <button class="btn" id="btnQuote">견적 받기</button>
            <button class="btn primary" id="btnCreateOrder" disabled>주문 생성</button>
            <span class="badge warn" id="quoteBadge" style="display:none">견적 유효시간: <span id="quoteT">30</span>s</span>
            <span class="badge" id="kycBadge">KYC: <span id="kycState">미완료</span></span>
          </div>

          <div class="footnote">
            <div class="muted">
              운영 팁: 실제 서비스는 <b>KYC/AML</b> 완료 전 거래 제한, 출금은 <b>관리자 승인</b> 후 실행 권장.
            </div>
          </div>
        </div>
      </section>

      <!-- Right: Order + Status -->
      <aside class="card">
        <div class="hd">
          <div>
            <h2>주문 상태</h2>
            <p>주문 생성 후 입금/컨펌 → 정산까지 상태를 추적합니다.</p>
          </div>
          <button class="btn" id="btnRefresh">새로고침</button>
        </div>

        <div class="bd">
          <div class="item" id="currentOrderBox" style="display:none">
            <div class="top">
              <div>
                <div class="id">Order ID: <span id="curOrderId"></span></div>
                <div style="margin-top:6px" class="split">
                  <span class="badge" id="curSide"></span>
                  <span class="badge" id="curChain"></span>
                  <span class="badge" id="curStatus"></span>
                </div>
              </div>
              <div class="right">
                <button class="btn" id="btnCopy">복사</button>
              </div>
            </div>
            <div class="hr"></div>
            <div class="muted" id="curInstr"></div>
            <div class="hr"></div>
            <div class="row">
              <div class="k">
                <div class="t">KRW</div>
                <div class="v" id="curKrw">—</div>
              </div>
              <div class="k">
                <div class="t">USDT</div>
                <div class="v" id="curUsdt">—</div>
              </div>
            </div>
          </div>

          <div class="list" id="historyList">
            <div class="item">
              <div class="top">
                <div>
                  <div style="font-weight:650">최근 주문</div>
                  <div class="muted" style="margin-top:4px">-</div>
                </div>
                <span class="badge">MVP</span>
              </div>
            </div>
          </div>

          <div class="footnote">
            <div class="muted">연동 포인트</div>
            <div class="muted">• <span class="mono">POST /api/quote</span> → 견적 생성</div>
            <div class="muted">• <span class="mono">POST /api/orders</span> → 주문 생성</div>
            <div class="muted">• <span class="mono">GET /api/orders/:id</span> → 상태 조회</div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast"><strong id="toastT">알림</strong><span id="toastM"></span></div>

  <script>
    // =========================
    //  OrangeX Front-end MVP
    //  - No framework, single file
    //  - Local mock state + API placeholders
    // =========================

    const API_BASE = "/api"; // 배포 시 프록시/리버스프록시로 연결 가능
    const $ = (id) => document.getElementById(id);

    const state = {
      side: "BUY",
      kyc: false,
      quote: null,
      quoteTimer: null,
      quoteT: 30,
      orders: loadOrders(),
      currentOrderId: null,
      // 데모 가격(서버 견적 전 임시 표시)
      midPrice: 1350,
      feeRate: 0.003,
      spreadBps: 80
    };

    // ---------- UI wiring ----------
    const tabBuy = $("tabBuy");
    const tabSell = $("tabSell");
    const bankBox = $("bankBox");
    const addrBox = $("addrBox");
    const addrLabel = $("addrLabel");
    const addrHint = $("addrHint");
    const kUsdtHint = $("kUsdtHint");

    tabBuy.onclick = () => setSide("BUY");
    tabSell.onclick = () => setSide("SELL");

    $("btnKyc").onclick = () => {
      state.kyc = true;
      $("kycState").textContent = "완료";
      $("kycBadge").classList.add("good");
      toast("KYC 완료", "거래 기능이 활성화되었습니다.");
      updateButtons();
    };

    $("btnLogin").onclick = () => {
      toast("로그인(데모)", "실서비스에서는 인증/2FA를 연결하세요.");
    };

    $("btnQuote").onclick = () => getQuote();
    $("btnCreateOrder").onclick = () => createOrder();
    $("btnRefresh").onclick = () => refreshStatus();
    $("btnCopy").onclick = () => copyCurrent();

    $("krw").addEventListener("input", () => {
      formatKrwInput();
      updatePreview();
      updateButtons();
    });
    $("chain").addEventListener("change", () => {
      updatePreview();
    });

    // ---------- initial paint ----------
    updatePreview();
    renderHistory();

    // ---------- helpers ----------
    function setSide(side){
      state.side = side;
      tabBuy.classList.toggle("active", side==="BUY");
      tabSell.classList.toggle("active", side==="SELL");
      tabBuy.setAttribute("aria-selected", side==="BUY");
      tabSell.setAttribute("aria-selected", side==="SELL");

      if(side==="SELL"){
        bankBox.style.display = "";
        addrLabel.textContent = "USDT 입금 주소 (서비스 제공)";
        addrHint.textContent = "매도 시: 아래 주소로 USDT를 입금하면 확인 후 원화를 지급합니다.";
        kUsdtHint.textContent = "매도 기준: USDT 입금 수량(예상)";
      } else {
        bankBox.style.display = "none";
        addrLabel.textContent = "USDT 수령 주소 (사용자 지갑)";
        addrHint.textContent = "매수 시: 결제 완료 후 이 주소로 USDT가 출금됩니다.";
        kUsdtHint.textContent = "매수 기준: 수수료 제외 후 계산";
      }
      // side 변경 시 기존 견적 무효 처리
      clearQuote();
      updatePreview();
      updateButtons();
    }

    function formatKrwInput(){
      const el = $("krw");
      const digits = el.value.replace(/[^\d]/g,"");
      el.value = digits ? Number(digits).toLocaleString("ko-KR") : "";
    }

    function getKrwNumber(){
      const v = $("krw").value.replace(/[^\d]/g,"");
      return v ? Number(v) : 0;
    }

    function calcPreview(){
      const amountFiat = getKrwNumber();
      const side = state.side;
      const mid = state.midPrice;
      const spread = state.spreadBps/10000;

      const price = side==="BUY" ? mid*(1+spread) : mid*(1-spread);
      const feeFiat = amountFiat * state.feeRate;
      const netFiat = Math.max(0, amountFiat - feeFiat);
      const usdt = netFiat / price;

      return { price, usdt, feeFiat };
    }

    function updatePreview(){
      const { price, usdt } = calcPreview();
      $("kPrice").textContent = price ? Math.round(price).toLocaleString("ko-KR")+" KRW" : "—";
      $("kUsdt").textContent = usdt ? usdt.toFixed(2).toLocaleString("ko-KR")+" USDT" : "—";
    }

    function updateButtons(){
      const amountFiat = getKrwNumber();
      const chain = $("chain").value;
      const address = $("address").value.trim();
      const bankOk = state.side==="SELL" ? ($("bankName").value.trim() && $("bankAcct").value.trim()) : true;
      const addrOk = !!address;

      // 견적은 KYC 없이도 볼 수는 있게(데모), 주문 생성은 KYC 필요
      $("btnQuote").disabled = amountFiat <= 0;
      $("btnCreateOrder").disabled =
        !state.kyc || !state.quote || amountFiat<=0 || !chain || !addrOk || !bankOk;
    }

    async function getQuote(){
      const amountFiat = getKrwNumber();
      if(amountFiat<=0) return toast("입력 필요", "원화 금액을 입력하세요.");

      const payload = {
        side: state.side,
        fiat: "KRW",
        crypto: "USDT",
        amountFiat,
        chain: $("chain").value
      };

      // 데모: 서버 연동 전에도 동작하도록 로컬에서 quote 생성
      // 실제 연동 시 아래 fetch를 활성화하고, 서버 응답(quote)을 state.quote에 넣으면 됨.
      /*
      const res = await fetch(`${API_BASE}/quote`, {
        method:"POST", headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      */

      const { price, usdt, feeFiat } = calcPreview();
      const data = {
        quote: {
          id: "q_"+Date.now(),
          ...payload,
          price,
          feeFiat,
          amountCrypto: usdt,
          expiresAt: Date.now() + 30_000
        }
      };

      state.quote = data.quote;
      toast("견적 생성", `유효시간 30초 • ${Math.round(state.quote.price).toLocaleString("ko-KR")} KRW/USDT`);
      startQuoteTimer();
      updateButtons();
    }

    function startQuoteTimer(){
      clearQuoteTimer();
      state.quoteT = 30;
      $("quoteBadge").style.display = "";
      $("quoteT").textContent = state.quoteT;

      state.quoteTimer = setInterval(() => {
        state.quoteT -= 1;
        $("quoteT").textContent = state.quoteT;
        if(state.quoteT <= 0){
          clearQuote();
          toast("견적 만료", "다시 견적을 받아주세요.");
        }
      }, 1000);
    }

    function clearQuote(){
      state.quote = null;
      clearQuoteTimer();
      $("quoteBadge").style.display = "none";
      updateButtons();
    }

    function clearQuoteTimer(){
      if(state.quoteTimer) clearInterval(state.quoteTimer);
      state.quoteTimer = null;
    }

    async function createOrder(){
      if(!state.quote) return toast("견적 필요", "먼저 견적을 받아주세요.");
      if(!state.kyc) return toast("KYC 필요", "KYC 완료 후 주문을 생성할 수 있어요.");

      const amountFiat = getKrwNumber();
      const chain = $("chain").value;
      const address = $("address").value.trim();

      if(!address) return toast("주소 필요", "지갑 주소를 입력하세요.");
      if(state.side==="SELL"){
        if(!$("bankName").value.trim() || !$("bankAcct").value.trim()){
          return toast("계좌 필요", "원화 지급 계좌 정보를 입력하세요.");
        }
      }

      const payload = {
        userId: "demo_user_1",
        quoteId: state.quote.id,
        side: state.side,
        chain,
        fiatAmount: amountFiat,
        cryptoAmount: state.quote.amountCrypto,
        payout: state.side==="BUY"
          ? { usdtAddress: address }
          : { bankName: $("bankName").value.trim(), bankAccount: $("bankAcct").value.trim() }
      };

      // 실제 연동 시:
      /*
      const res = await fetch(`${API_BASE}/orders`, {
        method:"POST", headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      const order = data.order;
      */

      // 데모: 로컬 주문 생성 + 상태 플로우
      const order = {
        id: "o_"+Date.now(),
        ...payload,
        status: state.side==="BUY" ? "PENDING_KRW_DEPOSIT" : "PENDING_USDT_DEPOSIT",
        createdAt: new Date().toISOString(),
        // 데모용 안내 문구
        instructions: state.side==="BUY"
          ? "은행 입금 안내(데모): 30분 내 원화 입금 → 확인 후 USDT 출금"
          : "USDT 입금 안내(데모): 아래 주소로 입금 → 확인 후 원화 지급"
      };

      state.orders.unshift(order);
      state.currentOrderId = order.id;
      saveOrders(state.orders);

      clearQuote();
      renderCurrentOrder(order);
      renderHistory();
      toast("주문 생성 완료", `${order.id} • 상태: ${order.status}`);
    }

    async function refreshStatus(){
      // 실제 연동 시:
      // const id = state.currentOrderId; fetch(`${API_BASE}/orders/${id}`) ...
      const id = state.currentOrderId;
      if(!id) return toast("주문 없음", "먼저 주문을 생성하세요.");

      const order = state.orders.find(o => o.id === id);
      if(!order) return toast("오류", "주문을 찾을 수 없습니다.");

      // 데모 상태 전이(클릭할 때마다 한 단계 진행)
      const next = {
        "PENDING_KRW_DEPOSIT": "KRW_RECEIVED",
        "KRW_RECEIVED": "USDT_SENT",
        "USDT_SENT": "SETTLED",
        "PENDING_USDT_DEPOSIT": "USDT_RECEIVED",
        "USDT_RECEIVED": "KRW_SENT",
        "KRW_SENT": "SETTLED",
        "SETTLED": "SETTLED"
      };
      order.status = next[order.status] || order.status;

      // 상태별 안내
      if(order.status === "KRW_RECEIVED"){
        order.instructions = "원화 입금 확인됨(데모) → USDT 출금 처리 중";
      } else if(order.status === "USDT_SENT"){
        order.instructions = "USDT 출금 완료(데모) → 정산 마감 처리 중";
      } else if(order.status === "USDT_RECEIVED"){
        order.instructions = "USDT 입금 확인됨(데모) → 원화 지급 처리 중";
      } else if(order.status === "KRW_SENT"){
        order.instructions = "원화 지급 완료(데모) → 정산 마감 처리 중";
      } else if(order.status === "SETTLED"){
        order.instructions = "정산 완료(데모) ✅";
      }

      saveOrders(state.orders);
      renderCurrentOrder(order);
      renderHistory();
      toast("상태 갱신", `현재 상태: ${order.status}`);
    }

    function renderCurrentOrder(order){
      $("currentOrderBox").style.display = "";
      $("curOrderId").textContent = order.id;
      $("curSide").textContent = order.side === "BUY" ? "BUY(매수)" : "SELL(매도)";
      $("curChain").textContent = order.chain;
      $("curStatus").textContent = order.status;

      // status badge color
      $("curStatus").className = "badge";
      if(order.status.includes("PENDING")) $("curStatus").classList.add("warn");
      if(order.status.includes("RECEIVED") || order.status.includes("SENT")) $("curStatus").classList.add("good");
      if(order.status === "SETTLED") $("curStatus").classList.add("good");

      $("curInstr").textContent = order.instructions || "";
      $("curKrw").textContent = Number(order.fiatAmount).toLocaleString("ko-KR") + " KRW";
      $("curUsdt").textContent = Number(order.cryptoAmount).toFixed(2) + " USDT";
    }

    function renderHistory(){
      const list = $("historyList");
      // 첫 안내 아이템 유지
      list.innerHTML = `
        <div class="item">
          <div class="top">
            <div>
              <div style="font-weight:650">최근 주문</div>
              <div class="muted" style="margin-top:4px">데모에서는 브라우저 로컬에 저장됩니다.</div>
            </div>
            <span class="badge">MVP</span>
          </div>
        </div>
      `;

      state.orders.slice(0,6).forEach(o => {
        const el = document.createElement("div");
        el.className = "item";
        el.style.cursor = "pointer";
        el.onclick = () => { state.currentOrderId = o.id; renderCurrentOrder(o); };

        const stClass =
          o.status.includes("PENDING") ? "badge warn"
          : (o.status === "SETTLED" ? "badge good" : "badge");

        el.innerHTML = `
          <div class="top">
            <div>
              <div style="font-weight:650">${o.side==="BUY" ? "매수" : "매도"} • ${Number(o.fiatAmount).toLocaleString("ko-KR")} KRW</div>
              <div class="id" style="margin-top:4px">${o.id} • ${o.chain}</div>
            </div>
            <span class="${stClass}">${o.status}</span>
          </div>
        `;
        list.appendChild(el);
      });

      if(state.currentOrderId){
        const cur = state.orders.find(o => o.id === state.currentOrderId);
        if(cur) renderCurrentOrder(cur);
      }
    }

    async function copyCurrent(){
      const id = state.currentOrderId;
      if(!id) return toast("복사 실패", "현재 선택된 주문이 없습니다.");
      try{
        await navigator.clipboard.writeText(id);
        toast("복사됨", id);
      }catch(e){
        toast("복사 실패", "브라우저 권한을 확인하세요.");
      }
    }

    function toast(title, msg){
      const t = $("toast");
      $("toastT").textContent = title;
      $("toastM").textContent = msg;
      t.style.display = "block";
      clearTimeout(t._h);
      t._h = setTimeout(() => t.style.display = "none", 2600);
    }

    function loadOrders(){
      try{
        const raw = localStorage.getItem("orangex_orders");
        return raw ? JSON.parse(raw) : [];
      }catch(e){ return []; }
    }
    function saveOrders(orders){
      localStorage.setItem("orangex_orders", JSON.stringify(orders));
    }

    // 초기 버튼 상태
    updateButtons();
    // 입력 변화(주소/계좌) 반영
    ["address","bankName","bankAcct"].forEach(id => {
      const el = $(id); if(!el) return;
      el.addEventListener("input", updateButtons);
    });
  </script>
</body>
</html>